h1. Basic Multicast Optimizations

One neat thing about layer 2 mesh networking is, that you get multicast support "out-of-the-box". You can easily create an application which is able to send some information to multiple targets, for instance by simply sending to an IP multicast address. This can even potentially safe bandwidth because your packet only has to pass a link once even though you are addressing many hosts.

However, especially in larger mesh networks the amount of multicast sending applications quickly accumulates. With a classic flooding approach, so simply distributing all multicast traffic to all hosts, this can become a non-negligable burdon on the overall mesh network.

Looking at the multicast traffic more thoroughly often reveals that most of this multicast traffic is actually only having one, two or even zero hosts interested in it.

Fortunately, IP multicast provides mechanisms to learn about the presence and amount of these so called multicast listeners. This is interesting for layer 3 IP multicast routers, but also professional layer 2 switches make use of this to reduce multicast overhead, advertising these products as "multicast aware" or "IGMP/MLD snooping switches".


h2. Overview

The current multicast optimizations in batman-adv provides a basic infrastructure for multicast awareness and therefore reduced multicast overhead in some setups.

So far, this basic optimization reduces overhead in the following two ways:

h3. Discards IPv4/IPv6 packets with no multicast listener

!{width: 66%25;}basic-multicast-no-receiver.png!

batman-adv detects whether there are any potential IPv4/IPv6 multicast listeners interested in traffic to the according multicast destination address. If not then the packet is never forwarded into the mesh network.

h3. Forwards IPv4/IPv6 packets with a single multicast listener via unicast

!{width: 66%25;}basic-multicast-single-receiver.png!

If a single multicast listener was detected then the packet is forwarded directly to the according batman-adv node.


h3. Limitations

!{width: 66%25;}basic-multicast-multiple-receivers.png!

In the following cases multicast packets are still distributed via classic flooding:

* If there is more than one listener for a specific multicast group.
* If there is a node with a Linux bridge on top of its batman-adv interface.
* If the multicast packets have a scope greater than link-local.

(These things are work in progress and will be supported at a later time.)


h2. How to activate the basic multicast optimizations?

By default they are activated. You can force the old behaviour, classic flooding of all multicast frames, on a certain node via the following command, executed as root (here: bat0):

<pre>echo 0 > /sys/class/net/bat0/mesh/multicast_mode</pre>

Note: This only affects multicast traffic originating from this specific node.

h2. Further Readings

* [[Basic-multicast-optimizations-tech|Basic Multicast Optimizations – Technical Description]]
* [[Basic-multicast-optimizations-flags|Basic Multicast Optimizations – Flags Explained]]