h1. Basic Multicast Optimizations

h2. Overview

The current multicast optimizations in batman-adv provides a basic infrastructure for multicast awareness and reduced multicast overhead in some setups.

So far, this basic optimization reduces overhead in the following two ways:

h3. Discards IPv4/IPv6 packets with no multicast listener

!{width: 66%25;}basic-multicast-no-receiver.png!

batman-adv detects whether there are any potential IPv4/IPv6 multicast listeners interested in traffic to the according multicast destination address. If not then the packet is never forwarded into the mesh network.

h3. Forwards IPv4/IPv6 packets with a single multicast listener via unicast

!{width: 66%25;}basic-multicast-single-receiver.png!

If a single multicast listener was detected then the packet is forwarded directly to the according batman-adv node.


h3. Limitations

!{width: 66%25;}basic-multicast-multiple-receivers.png!

If there is more than one listener then packets are flooded as it was done so far.

Also if there is a node with a Linux bridge on top of its batman-adv interface in the mesh then all multicast packets are flooded (supporting bridges is work in progress and requires additional changes to and interaction with the Linux bridge code).


h2. Infrastructure

h3. Multicast Listener Announcements

The IPv4/IPv6 multicast listeners, more precisely the according multicast MAC addresses, of a batman-adv node are announced via the [[open-mesh:2012-05-13-translation-table-in-a-nutshell|translation table infrastructure]].

h3. Multicast TVLV

For one thing the availability of the Multicast TVLV signalizes the capability to perform Multicast Listener Announcements to other nodes.

h4. Multicast TVLV format

 * definition:
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |   TVLV 0x06   |    Version    |             Length            | 
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 | MCAST Flags   |
 +-+-+-+-+-+-+-+-+
</pre>

h4. Multicast TVLV Flags

<pre>
 +-+-+-+-+-+-+-+-+
 |0|1|2|3|4|5|6|7|
 +-+-+-+-+-+-+-+-+
</pre>

* _0/BATADV_MCAST_WANT_ALL_UNSNOOPABLES:_
* _1/BATADV_MCAST_WANT_ALL_IPV4:_
* _2/BATADV_MCAST_WANT_ALL_IPV6:_
* _3-7:_ reserved for future extensions