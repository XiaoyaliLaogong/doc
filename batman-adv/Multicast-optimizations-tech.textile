h1. Basic Multicast Optimizations - Technical Description

h2. Multicast Listener Announcements

!{width: 66%25;}basic-multicast-listener-announce.png!

The IPv4/IPv6 multicast code in the Linux kernel keeps track of any of its applications requesting to receive multicast packets for a certain group.

batman-adv queries this local database and announces these so called multicast listeners, more precisely the according multicast MAC addresses, to the rest of the mesh network via the [[open-mesh:2012-05-13-translation-table-in-a-nutshell|translation table infrastructure]].

h2. Multicast TVLV

A node capable of performing Multicast Listener Announcements signalizes this by attaching a Multicast TVLV to its OGMs.

So far a node with a Linux bridge on top of its batman-adv interface is not capable of detecting and announcing multicast listeners behind its bridge. Therefore such nodes _must not_ and do not attach a Multicast TVLV to their OGMs.


h3. Multicast TVLV format

 * definition:
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |   TVLV 0x06   |    Version    |             Length            | 
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 | MCAST Flags   |
 +-+-+-+-+-+-+-+-+
</pre>

h3. Multicast TVLV Flags

<pre>
 +-+-+-+-+-+-+-+-+
 |0|1|2|3|4|5|6|7|
 +-+-+-+-+-+-+-+-+
</pre>

h4. BATADV_MCAST_WANT_ALL_UNSNOOPABLES (Bit 0):

Signalizes that this node wants all unsnoopable multicast traffic, that is traffic destined to the all-nodes address for IPv6 (ff02::1) and to link-local addresses for IPv4 (224.0.0.0/24). This is usually the case when a node uses a bridge device on top of bat0 and is therefore unable to detect potential bridged-in listeners.

(not used by listeners yet, but implemented for senders already to ensure backwards compatibility later)

h4. BATADV_MCAST_WANT_ALL_IPV4 (Bit 1):

Signalizes that this node wants all IPv4 multicast traffic. This is usually the case when a node uses a bridge device on top of bat0, has an IGMP querier (no matter if IGMPv2 or IGMPv3) behind it and is therefore not able to reliably determine all of its IGMPv2 listeners.

(not used by listeners yet, but implemented for senders already to ensure backwards compatibility later)

h4. BATADV_MCAST_WANT_ALL_IPV6 (Bit 2):

Signalizes that this node wants all IPv6 multicast traffic. This is usually the case when a node uses a bridge device on top of bat0, has an MLD querier (no matter if MLDv1 or MLDv2) behind it and is therefore not able to reliably determine all of its MLDv1 listeners.

(not used by listeners yet, but implemented for senders already to ensure backwards compatibility later)

h4. Bits 3 to 7:

reserved for future extensions